<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Transactions ‚Äî Local JSON Viewer</title>
  <style>
    :root{
      --bg:#f6f8fb;--card:#ffffff;--muted:#6b7280;--accent:#2563eb;
      --radius:12px;--shadow:0 8px 24px rgba(16,24,40,0.06);
      font-family:Inter,ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial;
    }
    body{margin:20px;background:var(--bg);color:#0f172a;-webkit-font-smoothing:antialiased}
    .wrap{max-width:1100px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:8px}
    h1{margin:0;font-size:20px}
    .muted{color:var(--muted);font-size:13px}
    .card{background:var(--card);border-radius:var(--radius);padding:16px;box-shadow:var(--shadow);margin-top:16px}
    input,select,button{padding:8px 10px;border-radius:8px;border:1px solid #e6eef8;background:white}
    button{cursor:pointer}
    button.primary{background:var(--accent);color:white;border:none}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:10px 8px;border-bottom:1px solid #f1f5f9;font-size:14px;text-align:left}
    th{font-weight:600;color:#111827;cursor:pointer;user-select:none}
    tbody tr:hover{background:rgba(37,99,235,0.05)}
    .controls{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:10px}
    .pager{display:flex;justify-content:flex-end;gap:8px;align-items:center;margin-top:12px}
    .pager button{padding:6px 10px}
    @media(max-width:800px){
      th:nth-child(3),td:nth-child(3){display:none}
      .pager{justify-content:center}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div>
        <h1>Transactions</h1>
        <p class="muted">Load local JSON ‚Üí search, sort, paginate, export CSV or JSON</p>
      </div>
      <div class="muted">Status: <strong>Local</strong></div>
    </header>

    <div class="card">
      <div class="controls">
        <input id="search" placeholder="Search..." />
        <select id="typeFilter">
          <option value="">All types</option><option>BUY</option><option>SELL</option>
        </select>
        <select id="perPage">
          <option value="5">5 / page</option><option value="10" selected>10 / page</option><option value="25">25 / page</option>
        </select>
        <button id="exportCsv">Export CSV</button>
        <button id="exportJson">Save JSON</button>
        <button id="resetBtn">Reset</button>
        <label style="cursor:pointer;background:#f3f4f6;padding:8px 10px;border-radius:8px">
          üìÅ Load JSON
          <input type="file" id="jsonFile" accept=".json" style="display:none"/>
        </label>
      </div>

      <div class="muted" id="resultsMeta">0 results</div>

      <table id="txTable">
        <thead>
          <tr>
            <th data-key="id" data-type="number">ID ‚ñæ</th>
            <th data-key="symbol" data-type="string">Symbol</th>
            <th data-key="type" data-type="string">Type</th>
            <th data-key="quantity" data-type="number">Quantity</th>
            <th data-key="price" data-type="number">Price</th>
            <th data-key="date" data-type="date">Date</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>

      <div class="pager">
        <div class="muted" id="pageInfo">Page 1 / 1</div>
        <button id="prev">Prev</button>
        <button id="next">Next</button>
      </div>
    </div>
  </div>

  <script>
    // Sample fallback data
    const SAMPLE_DATA=[
      {id:1,symbol:"AAPL",type:"BUY",quantity:10,price:173.45,date:"2025-10-01T09:12:00Z"},
      {id:2,symbol:"GOOG",type:"SELL",quantity:2,price:2840,date:"2025-10-02T11:02:00Z"},
      {id:3,symbol:"TSLA",type:"BUY",quantity:5,price:240.12,date:"2025-10-03T13:22:00Z"}
    ];
    let data=[...SAMPLE_DATA],filtered=[...data],sortKey='id',sortDir=-1,currentPage=1,perPage=10;

    const tbody=document.querySelector('#txTable tbody'),
      searchEl=document.getElementById('search'),
      typeFilter=document.getElementById('typeFilter'),
      perPageEl=document.getElementById('perPage'),
      resultsMeta=document.getElementById('resultsMeta'),
      pageInfo=document.getElementById('pageInfo'),
      prevBtn=document.getElementById('prev'),
      nextBtn=document.getElementById('next'),
      exportBtn=document.getElementById('exportCsv'),
      exportJsonBtn=document.getElementById('exportJson'),
      resetBtn=document.getElementById('resetBtn'),
      jsonFile=document.getElementById('jsonFile'),
      headers=document.querySelectorAll('thead th');

    const fmtDate=iso=>new Date(iso).toLocaleString();

    const compare=(a,b,type)=>{
      if(type==='number')return a-b;
      if(type==='date')return new Date(a)-new Date(b);
      return String(a).localeCompare(String(b));
    };

    const toCSV=rows=>{
      const keys=['id','symbol','type','quantity','price','date'];
      const lines=[keys.join(',')];
      rows.forEach(r=>{
        lines.push(keys.map(k=>`"${(r[k]??'').toString().replace(/"/g,'""')}"`).join(','));
      });
      return lines.join('\n');
    };

    const download=(fn,txt,type='text/plain')=>{
      const a=document.createElement('a');
      a.href=URL.createObjectURL(new Blob([txt],{type}));
      a.download=fn;document.body.appendChild(a);a.click();a.remove();
    };

    function applyFilters(){
      const q=searchEl.value.toLowerCase().trim(),tp=typeFilter.value;
      filtered=data.filter(d=>{
        if(tp&&d.type!==tp)return false;
        if(!q)return true;
        return Object.values(d).some(v=>String(v).toLowerCase().includes(q));
      });
      filtered.sort((a,b)=>{
        const type=document.querySelector(`th[data-key="${sortKey}"]`).dataset.type;
        return compare(a[sortKey],b[sortKey],type)*sortDir;
      });
      const pages=Math.max(1,Math.ceil(filtered.length/perPage));
      if(currentPage>pages)currentPage=pages;
    }

    function render(){
      applyFilters();
      const total=filtered.length;
      const pages=Math.max(1,Math.ceil(total/perPage));
      const start=(currentPage-1)*perPage;
      const pageItems=filtered.slice(start,start+perPage);
      tbody.innerHTML=pageItems.map(t=>`
        <tr>
          <td>${t.id}</td><td>${t.symbol}</td><td>${t.type}</td>
          <td>${t.quantity}</td><td>${t.price}</td><td>${fmtDate(t.date)}</td>
        </tr>`).join('')||'<tr><td colspan="6" style="text-align:center;color:gray">No results</td></tr>';
      resultsMeta.textContent=`${total} result${total!==1?'s':''}`;
      pageInfo.textContent=`Page ${currentPage} / ${pages}`;
      prevBtn.disabled=currentPage<=1;
      nextBtn.disabled=currentPage>=pages;
      headers.forEach(h=>{
        h.textContent=h.textContent.replace(/[‚ñ¥‚ñæ]/g,'');
        if(h.dataset.key===sortKey)h.textContent+=sortDir===1?' ‚ñ¥':' ‚ñæ';
      });
    }

    // event listeners
    searchEl.oninput=()=>{currentPage=1;render()};
    typeFilter.onchange=()=>{currentPage=1;render()};
    perPageEl.onchange=()=>{perPage=parseInt(perPageEl.value,10);currentPage=1;render()};
    prevBtn.onclick=()=>{if(currentPage>1){currentPage--;render()}};
    nextBtn.onclick=()=>{const pages=Math.ceil(filtered.length/perPage);if(currentPage<pages){currentPage++;render()}};
    headers.forEach(h=>h.onclick=()=>{if(sortKey===h.dataset.key)sortDir=-sortDir;else{sortKey=h.dataset.key;sortDir=h.dataset.type==='string'?1:-1;}render()});
    exportBtn.onclick=()=>download('transactions.csv',toCSV(filtered),'text/csv');
    exportJsonBtn.onclick=()=>download('transactions.json',JSON.stringify(filtered,null,2),'application/json');
    resetBtn.onclick=()=>{data=[...SAMPLE_DATA];searchEl.value='';typeFilter.value='';perPageEl.value='10';perPage=10;sortKey='id';sortDir=-1;currentPage=1;render()};
    jsonFile.onchange=e=>{
      const file=e.target.files[0];
      if(!file)return;
      const reader=new FileReader();
      reader.onload=ev=>{
        try{
          const parsed=JSON.parse(ev.target.result);
          if(Array.isArray(parsed)){
            data=parsed;currentPage=1;
            alert(`Loaded ${parsed.length} records from ${file.name}`);
            render();
          }else alert('JSON must be an array of transaction objects.');
        }catch(err){alert('Invalid JSON file.');}
      };
      reader.readAsText(file);
    };

    render();
  </script>
</body>
</html>
